<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>General Markov Chain Monte Carlo for BAMLSS — sam_GMCMC • bamlss</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="General Markov Chain Monte Carlo for BAMLSS — sam_GMCMC" />
<meta property="og:description" content="These functions provide a quite general infrastructure for sampling BAMLSS. The default
  proposal function is based on iteratively weighted least squares (IWLS), however,
  each model term may have a different updating function, see the details." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
    <li>
      <a href="../articles/families.html">Families</a>
    </li>
    <li>
      <a href="../articles/bf.html">BAMLSS Model Frame</a>
    </li>
    <li>
      <a href="../articles/engines.html">Estimation Engines</a>
    </li>
    <li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/multinomial.html">Bayesian Multinomial Regression</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Example</a>
    </li>
    <li>
      <a href="../articles/zn.html">Spatial Location-Scale Model</a>
    </li>
    <li>
      <a href="../articles/fatalities.html">Fatalities Model for Austria</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Publications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jm.html">Bayesian Joint Models for Longitudinal and Survival Data</a>
    </li>
    <li>
      <a href="../articles/bivnorm.html">Bivariate Gaussian Models for Wind Vectors</a>
    </li>
    <li>
      <a href="../articles/cox.html">Complex Space-Time Interactions in a Cox Model</a>
    </li>
    <li>
      <a href="../articles/lasso.html">LASSO-Type Penalization in the Framework of GAMLSS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>General Markov Chain Monte Carlo for BAMLSS</h1>
    
    <div class="hidden name"><code>GMCMC.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions provide a quite general infrastructure for sampling BAMLSS. The default
  proposal function is based on iteratively weighted least squares (IWLS), however,
  each model term may have a different updating function, see the details.</p>
    </div>

    <pre class="usage"><span class='co'>## Sampler functions:</span>
<span class='fu'>sam_GMCMC</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>family</span>, <span class='kw'>start</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>n.iter</span> <span class='kw'>=</span> <span class='fl'>1200</span>, <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>thin</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>step</span> <span class='kw'>=</span> <span class='fl'>20</span>, <span class='kw'>propose</span> <span class='kw'>=</span> <span class='st'>"iwlsC_gp"</span>, <span class='kw'>chains</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>GMCMC</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>family</span>, <span class='kw'>start</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>n.iter</span> <span class='kw'>=</span> <span class='fl'>1200</span>, <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>thin</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>step</span> <span class='kw'>=</span> <span class='fl'>20</span>, <span class='kw'>propose</span> <span class='kw'>=</span> <span class='st'>"iwlsC_gp"</span>, <span class='kw'>chains</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'>## Propose functions:</span>
<span class='fu'>GMCMC_iwls</span>(<span class='no'>family</span>, <span class='no'>theta</span>, <span class='no'>id</span>, <span class='no'>eta</span>, <span class='no'>y</span>, <span class='no'>data</span>,
  <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)
<span class='fu'>GMCMC_iwlsC</span>(<span class='no'>family</span>, <span class='no'>theta</span>, <span class='no'>id</span>, <span class='no'>eta</span>, <span class='no'>y</span>, <span class='no'>data</span>,
  <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>zworking</span>, <span class='no'>resids</span>, <span class='no'>rho</span>, <span class='no'>...</span>)
<span class='fu'>GMCMC_iwlsC_gp</span>(<span class='no'>family</span>, <span class='no'>theta</span>, <span class='no'>id</span>, <span class='no'>eta</span>, <span class='no'>y</span>, <span class='no'>data</span>,
  <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>zworking</span>, <span class='no'>resids</span>, <span class='no'>rho</span>, <span class='no'>...</span>)
<span class='fu'>GMCMC_slice</span>(<span class='no'>family</span>, <span class='no'>theta</span>, <span class='no'>id</span>, <span class='no'>eta</span>, <span class='no'>y</span>, <span class='no'>data</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>For function <code><a href='bfit.html'>bfit()</a></code> the <code>x</code> list, as returned from function
    <code><a href='bamlss.frame.html'>bamlss.frame</a></code>, holding all model matrices and other information that is used for
    fitting the model. For the updating functions an object as returned from function
    <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/smooth.construct'>smooth.construct</a></code> or <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/smoothCon'>smoothCon</a></code>.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>The model response, as returned from function <code><a href='bamlss.frame.html'>bamlss.frame</a></code>.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>A <span class="pkg">bamlss</span> family object, see <code><a href='family.bamlss.html'>family.bamlss</a></code>.</p></td>
    </tr>
    <tr>
      <th>start</th>
      <td><p>A named numeric vector containing possible starting values, the names are based on
    function <code><a href='parameters.html'>parameters</a></code>.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Prior weights on the data, as returned from function <code><a href='bamlss.frame.html'>bamlss.frame</a></code>.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>Can be used to supply model offsets for use in fitting,
    returned from function <code><a href='bamlss.frame.html'>bamlss.frame</a></code>.</p></td>
    </tr>
    <tr>
      <th>n.iter</th>
      <td><p>Sets the number of MCMC iterations.</p></td>
    </tr>
    <tr>
      <th>burnin</th>
      <td><p>Sets the burn-in phase of the sampler, i.e., the number of starting samples that
    should be removed.</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>Defines the thinning parameter for MCMC simulation. E.g., <code>thin = 10</code> means,
    that only every 10th sampled parameter will be stored.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Print information during runtime of the algorithm.</p></td>
    </tr>
    <tr>
      <th>step</th>
      <td><p>How many times should algorithm runtime information be printed, divides <code>n.iter</code>.</p></td>
    </tr>
    <tr>
      <th>propose</th>
      <td><p>Sets the propose function for model terms, e.g. for a term <code>s(x)</code> in the model
    formula. Per default this is set to <code>"iwlsC"</code>, a character pointing to the set of propose
    functions, see above. Other options are <code>"iwls"</code> and <code>"slice"</code>, however, this is
    more experimental and should not be set by the user. Another option is to pass a full propose
    function which should be used for each model term, the structure of propose functions is
    described in the details below. Model terms may also have different propose functions, see
    the example section.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>How many chains should be started? Chains a sampled sequentially!</p></td>
    </tr>
    <tr>
      <th>theta</th>
      <td><p>The current state of parameters, provided as a named list. The first level
    represents the parameters of the distribution, the second level the parameters of
    the model terms. E.g., using the <code><a href='family.bamlss.html'>gaussian_bamlss</a></code> family object
    <code>theta[["mu"]][["s(x)"]]</code> extracts the current state of a model term <code>"s(x)"</code>
    of the <code>"mu"</code> parameter. Extraction is done with the <code>id</code> argument.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>The parameter identifier, a character vector of length 2. The first character
    specifies the current distributional parameter, the second the current model term.</p></td>
    </tr>
    <tr>
      <th>eta</th>
      <td><p>The current value of the predictors, provided as a named list, one list entry
    for each parameter. The names correspond to the parameter names in the family object,
    see <code><a href='family.bamlss.html'>family.bamlss</a></code>. E.g., when using the <code><a href='family.bamlss.html'>gaussian_bamlss</a></code> family
    object, the current values for the mean can be extracted by <code>eta\$mu</code> and for the
    standard deviation by <code>eta\$sigma</code>.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>An object as returned from function
    <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/smooth.construct'>smooth.construct</a></code> or <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/smoothCon'>smoothCon</a></code>. The object is
    preprocessed by function <code><a href='bamlss.engine.setup.html'>bamlss.engine.setup</a></code>.</p></td>
    </tr>
    <tr>
      <th>zworking</th>
      <td><p>Preinitialized numeric vector of <code><a href='https://www.rdocumentation.org/packages/base/topics/length'>length(y)</a></code>, only for internal usage.</p></td>
    </tr>
    <tr>
      <th>resids</th>
      <td><p>Preinitialized numeric vector of <code><a href='https://www.rdocumentation.org/packages/base/topics/length'>length(y)</a></code>, only for internal usage.</p></td>
    </tr>
    <tr>
      <th>rho</th>
      <td><p>An environment, only for internal usage.</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>Arguments passed to function <code><a href='bamlss.engine.setup.html'>bamlss.engine.setup</a></code> and to the
    propose functions.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The sampler function <code>sam_GMCMC()</code> cycles through all distributional parameters and corresponding
  model terms in each iteration of the MCMC chain. Samples of the parameters of a model term (e.g.,
  <code>s(x)</code>) are generated by proposal functions, e.g. <code>GMCMC_iwls()</code>.</p>
<p>The default proposal function that should be used for all model terms is set with argument
  <code>propose</code>. For smooth terms, e.g. terms created with function <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/s'>s</a></code>, if
  a valid propose function is supplied within the extra <code>xt</code> list, this propose function will
  be used. This way each model term may have its own propose function for creating samples
  of the parameters. See the example section.</p>
<p>The default proposal function <code>GMCMC_iwlsC_gp</code> allows for general priors for the
  smoothing variances and general penalty functions. Samples of smoothing variances are computed
  using slice sampling. Function <code>GMCMC_iwlsC</code> samples smoothing variances of univariate terms
  assuming an inverse gamma prior. Terms of higher dimensions use again slice sampling for creating
  samples of smoothing variances.</p>
<p>Function <code>GMCMC_iwls</code> is similar to function <code>GMCMC_iwlsC</code> but uses plain <span style="R">R</span> code.</p>
<p>Function <code>GMCMC_slice</code> applies slice sampling also for the regression coefficients and
  is therefore relatively slow.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns samples of parameters, depending on the return value of the propose functions
  other quantities can be returned. The samples are provided as a <code><a href='https://www.rdocumentation.org/packages/coda/topics/mcmc'>mcmc</a></code> matrix.
  If <code>chains &gt; 1</code>, the samples are provided as a <code><a href='https://www.rdocumentation.org/packages/coda/topics/mcmc.list'>mcmc.list</a></code>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Umlauf N, Klein N, Zeileis A (2016). Bayesian Additive Models for Location
    Scale and Shape (and Beyond). <em>(to appear)</em></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='bamlss.html'>bamlss</a></code>, <code><a href='bamlss.frame.html'>bamlss.frame</a></code>,
  <code><a href='bamlss.engine.setup.html'>bamlss.engine.setup</a></code>, <code><a href='bamlss.engine.helpers.html'>set.starting.values</a></code>, <code><a href='s2.html'>s2</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'>## Simulated data example illustrating</span>
<span class='co'>## how to call the sampler function.</span>
<span class='co'>## This is done internally within</span>
<span class='co'>## the setup of function bamlss().</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='GAMart.html'>GAMart</a></span>()
<span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='no'>num</span> ~ <span class='fu'>s</span>(<span class='no'>x1</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>)
<span class='no'>bf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bamlss.frame.html'>bamlss.frame</a></span>(<span class='no'>f</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>d</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"gaussian"</span>)

<span class='co'>## First, find starting values with optimizer.</span>
<span class='no'>opt</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/with'>with</a></span>(<span class='no'>bf</span>, <span class='fu'><a href='bfit.html'>bfit</a></span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>family</span>))

<span class='co'>## Sample.</span>
<span class='no'>samps</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/with'>with</a></span>(<span class='no'>bf</span>, <span class='fu'>sam_GMCMC</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>family</span>, <span class='kw'>start</span> <span class='kw'>=</span> <span class='no'>opt</span>$<span class='no'>parameters</span>))
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/plot'>plot</a></span>(<span class='no'>samps</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

