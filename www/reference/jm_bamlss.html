<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit Flexible Additive Joint Models — jm_bamlss • bamlss</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Fit Flexible Additive Joint Models — jm_bamlss" />

<meta property="og:description" content="Family object to fit a flexible additive joint model for longitudinal and survival
  data under a Bayesian approach as presented in Koehler et al. (2017a, b). 
  All parts of the joint model can be specified as structured additive predictors. 
  See the details and examples." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/families.html">BAMLSS Families</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
    <li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Flexible Additive Joint Models</h1>
    
    <div class="hidden name"><code>jm_bamlss.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Family object to fit a flexible additive joint model for longitudinal and survival
  data under a Bayesian approach as presented in Koehler et al. (2017a, b). 
  All parts of the joint model can be specified as structured additive predictors. 
  See the details and examples.</p>
    
    </div>

    <pre class="usage"><span class='co'>## JM family object.</span>
<span class='fu'>jm_bamlss</span>(<span class='no'>...</span>)

<span class='co'>## "bamlss.frame" transformer function</span>
<span class='co'>## to set up joint models.</span>
<span class='fu'>jm.transform</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>data</span>, <span class='no'>terms</span>, <span class='no'>knots</span>, <span class='no'>formula</span>, <span class='no'>family</span>, <span class='kw'>subdivisions</span> <span class='kw'>=</span> <span class='fl'>25</span>,
  <span class='kw'>timedependent</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"lambda"</span>, <span class='st'>"mu"</span>, <span class='st'>"alpha"</span>, <span class='st'>"dalpha"</span>), <span class='kw'>timevar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>idvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='no'>.Machine</span>$<span class='no'>double.eps</span>, <span class='kw'>mu</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>sparse</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>nonlinear</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>edf_alt</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>start_mu</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>k_mu</span> <span class='kw'>=</span> <span class='fl'>6</span>, <span class='no'>...</span>)

<span class='co'>## Posterior mode optimizing engine.     </span>
<span class='fu'>jm.mode</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>start</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>criterion</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"AICc"</span>, <span class='st'>"BIC"</span>, <span class='st'>"AIC"</span>), <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>100</span>, <span class='fl'>1</span>),
  <span class='kw'>nu</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"lambda"</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='st'>"gamma"</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='st'>"mu"</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='st'>"sigma"</span> <span class='kw'>=</span> <span class='fl'>0.1</span>,
  <span class='st'>"alpha"</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='st'>"dalpha"</span> <span class='kw'>=</span> <span class='fl'>0.1</span>),
  <span class='kw'>update.nu</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='fl'>0.0001</span>, <span class='kw'>alpha.eps</span> <span class='kw'>=</span> <span class='fl'>0.001</span>, <span class='kw'>ic.eps</span> <span class='kw'>=</span> <span class='fl'>1e-08</span>,
  <span class='kw'>nback</span> <span class='kw'>=</span> <span class='fl'>40</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fl'>4</span>, <span class='no'>...</span>)

<span class='co'>## Sampler function.</span>
<span class='fu'>jm.mcmc</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>family</span>, <span class='kw'>start</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>n.iter</span> <span class='kw'>=</span> <span class='fl'>1200</span>, <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>thin</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fl'>4</span>,
  <span class='kw'>step</span> <span class='kw'>=</span> <span class='fl'>20</span>, <span class='no'>...</span>)

<span class='co'>## Predict function, set to default in jm_bamlss().</span>
<span class='fu'>jm.predict</span>(<span class='no'>object</span>, <span class='no'>newdata</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"link"</span>, <span class='st'>"parameter"</span>, <span class='st'>"probabilities"</span>, <span class='st'>"cumhaz"</span>, <span class='st'>"loglik"</span>),
  <span class='no'>dt</span>, <span class='no'>steps</span>, <span class='no'>id</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) { <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>x</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>) },
  <span class='kw'>subdivisions</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>chunks</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,  <span class='no'>...</span>)

<span class='co'>## Survival plot.</span>
<span class='fu'>jm.survplot</span>(<span class='no'>object</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>dt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>steps</span> <span class='kw'>=</span> <span class='fl'>10</span>,
  <span class='kw'>points</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>rug</span> <span class='kw'>=</span> !<span class='no'>points</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>The <code>x</code> list, as returned from function
    <code><a href='bamlss.frame.html'>bamlss.frame</a></code> (and transformed by function <code>jm.transform()</code>),
    holding all model matrices and other information that is used for
    fitting the model.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>The model response, as returned from function <code><a href='bamlss.frame.html'>bamlss.frame</a></code>.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A <code><a href='https://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></code> or <code><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></code> containing the model
    response variable(s) and covariates specified in the <code>formula</code> in long format.
    By default the variables are taken from <code><a href='https://www.rdocumentation.org/packages/base/topics/environment'>environment(formula)</a></code>:
    typically the environment from which <code>bamlss</code> is called.</p></td>
    </tr>
    <tr>
      <th>terms</th>
      <td><p>The corresponding <code><a href='terms.bamlss.html'>terms.bamlss</a></code> object needed for processing.</p></td>
    </tr>
    <tr>
      <th>knots</th>
      <td><p>An optional list containing user specified knots, see the documentation of
    function <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/gam'>gam</a></code>.</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>The corresponding <code><a href='bamlss.formula.html'>bamlss.formula</a></code>.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>The <code><a href='family.bamlss.html'>bamlss.family</a></code> object.</p></td>
    </tr>
    <tr>
      <th>subdivisions</th>
      <td><p>How many time points should be created for each individual.</p></td>
    </tr>
    <tr>
      <th>timedependent</th>
      <td><p>A character vector specifying the names of parameters in <code>x</code>
    that are time-dependent. Time grid design matrices are only computed for these parameters.</p></td>
    </tr>
    <tr>
      <th>timevar</th>
      <td><p>A character specifying the name of the survival time variable in the
    data set.</p></td>
    </tr>
    <tr>
      <th>idvar</th>
      <td><p>Depending on the type of data set, this is the name of the variable specifying
     identifier of individuals.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>Numeric, a starting value for the intercept of the association parameter alpha.</p></td>
    </tr>
    <tr>
      <th>mu</th>
      <td><p>Numeric, a starting value for the intercept of the mu parameter.</p></td>
    </tr>
    <tr>
      <th>sigma</th>
      <td><p>Numeric, a starting value for the intercept of the sigma parameter.</p></td>
    </tr>
    <tr>
      <th>sparse</th>
      <td><p>Logical, indicating if sparse matrix structures are used for updating and sampling
    of mu parameter model terms.</p></td>
    </tr>
    <tr>
      <th>nonlinear</th>
      <td><p>Logical, indicating if association is nonlinear in mu. See Details on the different
    model specifications.</p></td>
    </tr>
    <tr>
      <th>edf_alt</th>
      <td><p>Logical, indicating if an alternative computation of estimated degrees of freedom 
    for penalized model terms should be used.</p></td>
    </tr>
    <tr>
      <th>start_mu</th>
      <td><p>Starting values for the computation of mu. For estimating associations which are 
    nonlinear in mu, knot placement is based on these starting values which can improve stability.</p></td>
    </tr>
    <tr>
      <th>k_mu</th>
      <td><p>Number of knots for spline basis of association nonlinear in mu. Reducing this number
    improves stability of the estimation.</p></td>
    </tr>
    <tr>
      <th>start</th>
      <td><p>A named numeric vector containing possible starting values, the names are based on
    function <code><a href='parameters.html'>parameters</a></code>.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Currently not supported.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>Currently not supported.</p></td>
    </tr>
    <tr>
      <th>criterion</th>
      <td><p>Information criterion to be used, e.g., for smoothing
    variance selection. Options are the corrected AIC <code>"AICc"</code> (see Details), the <code>"BIC"</code> and
    <code>"AIC"</code>. Defaults to <code>"AICc"</code>?</p></td>
    </tr>
    <tr>
      <th>maxit</th>
      <td><p>Vector containing the maximum number of iterations for the backfitting
    algorithm with <code>maxit[1]</code> defining the iterations for the full model and <code>maxit[2]</code>
    the iterations within each predictor. <code>maxit[2]</code> defaults to 1 if only one value is
    specified.</p></td>
    </tr>
    <tr>
      <th>nu</th>
      <td><p>Vector of step lengths for parameter updates of one Newton-Raphson update for 
    each predictor of the joint model.</p></td>
    </tr>
    <tr>
      <th>update.nu</th>
      <td><p>Should the updating step length be optimized in each iteration
    of the backfitting algorithm? Uses <code>nu</code> as starting value if set to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>eps</th>
      <td><p>The relative convergence tolerance of the backfitting algorithm.</p></td>
    </tr>
    <tr>
      <th>alpha.eps</th>
      <td><p>The relative convergence tolerance of the backfitting algorithm
    for predictor alpha.</p></td>
    </tr>
    <tr>
      <th>ic.eps</th>
      <td><p>The relative convergence tolerance of the information criterion used, e.g.,
    for smoothing variance selection.</p></td>
    </tr>
    <tr>
      <th>nback</th>
      <td><p>For computing <code>ic.eps</code>, how many iterations back should be included
    when computing relative convergence tolerance of the information criterion.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Print information during runtime of the algorithm.</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>Set the digits for printing when <code>verbose = TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>n.iter</th>
      <td><p>the number of MCMC iterations.</p></td>
    </tr>
    <tr>
      <th>burnin</th>
      <td><p>the burn-in phase of the sampler, i.e., the number of starting samples that
    should be removed.</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>the thinning parameter for MCMC simulation. E.g., <code>thin = 10</code> means,
    that only every 10th sampled parameter will be stored.</p></td>
    </tr>
    <tr>
      <th>step</th>
      <td><p>How many times should algorithm runtime information be printed, divides <code>n.iter</code>.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>A <code>"bamlss"</code> object processed with the JM optimizer function
    <code>jm.mode()</code> ans/or sampler function <code>jm.mcmc()</code> for which the survival plot
    should be created.</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>Dataset for which to create predictions. Not needed for conditional survival probabilities.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Character string indicating which type of predictions to compute. <code>link</code> returns estimates
    for all predictors with the respective link functions applied, <code>"parameter"</code> returns the estimates
    for all pedictors, <code>"probabilities"</code> returns the survival probabilities conditional on the
    survival up to the last longitudinal measurement, and <code>"cumhaz"</code> return the cumulative hazard
    up to the survival time or for a time window after the last longitudinal measurement. If <code>type</code>
    is set to <code>"loglik"</code>, the log-likelihood of the joint model is returned.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>Integer or character, that specifies the individual for which the plot should be created.</p></td>
    </tr>
    <tr>
      <th>dt</th>
      <td><p>The time window after the last observed measurement for which predictions should be computed. 
    The default is <code>0.4 * max(obstime)</code> and <code>obstime</code> are the individual's longitudinal measurement times.</p></td>
    </tr>
    <tr>
      <th>steps</th>
      <td><p>Integer, the number of steps for which to evaluate the conditional survival probability 
    up to <code>dt</code>.</p></td>
    </tr>
    <tr>
      <th>FUN</th>
      <td><p>A function that should be applied on the samples of predictors or
    parameters, depending on argument <code>type</code>.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>Specifies the number of cores that should be used for prediction. Note that
    this functionality is based on the <code><a href='https://www.rdocumentation.org/packages/parallel/topics/parallel-package'>parallel</a></code> package.</p></td>
    </tr>
    <tr>
      <th>chunks</th>
      <td><p>Should computations be split into <code>chunks</code>? Prediction is then processed
    sequentially.</p></td>
    </tr>
    <tr>
      <th>points</th>
      <td><p>Should longitudinal observations be added to the plot.</p></td>
    </tr>
    <tr>
      <th>rug</th>
      <td><p>Should longitudinal observed time points be added on the x-axis to the plot.</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>Currently not used.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>We refer to the papers of Koehler et al. (2017a, b) for details on the flexible
additive joint model. In short, we model the hazard of subject \(i\) an event at time
\(t\) as
$$h_{i}(t)= \exp [\eta_{\lambda i}(t)+
\eta_{\gamma i}+\eta_{\alpha i}(\eta_{\mu i}(t), t) ]$$
with predictor \(\eta_{\lambda}\) for all survival covariates that are time-varying or have a
time-varying coefficient (including the log baseline hazard), predictor \(\eta_{\gamma}\) for
baseline survival covariates, predictor \(\eta_{\alpha}\) representing the potentially
time-varying or nonlinear association between the longitudinal marker \(\eta_{\mu}\) and the hazard. The
longitudinal response \(y_{ij}\) at time points \(t_{ij}\) is modeled as
$$y_{ij}=\eta_{\mu i}(t_{ij})+e_{ij}$$ with independent normal errors \(N(0, \exp[\eta_{\sigma i}(t_{ij})]^2)\).</p>
<p>Each predictor \(\eta_{ki}\) is a structured additive predictor, i.e. a sum of functions of
covariates \(\eta_{ki} =  \sum_{m=1}^{M_k} f_{km}(\bm{x}_{ki})\). Each of these functions can be
modeled parametrically or using basis function evaluations from the smooth constructors in
<span class="pkg">mgcv</span> such as <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/s'>s</a></code>, <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/te'>te</a></code> and <code><a href='https://www.rdocumentation.org/packages/mgcv/topics/te'>ti</a></code> and can
include smooth time-varying, random or spatial effects. For the Bayesian estimation of these effects
we specify corresponding priors: For linear or parametric terms we use vague normal priors, smooth
and random effect terms are regularized by placing generic multivariate normal priors on the
coefficients and for anisotropic smooths, when multiple smoothing variance parameters are involved,
more complex prior are in place (cf. Koehler et al., 2017a). We use inverse Gamma
hyper-priors, i.e. IG(0.001, 0.001) to obtain an inverse Gamma full conditional for the variance
parameters. We estimate the posterior mode by maximizing the log-posterior of the model using a
Newton-Raphson procedure, the posterior mean is obtained via derivative-based Metropolis-Hastings
sampling. We recommend to use posterior mode estimates for a quick model assessment. In order to
draw correct inferences from the model, posterior mean estimates should be computed. 
We approximate integration in the survival part of the likelihood using trapezoidal rule. For
posterior mode estimation.</p>
<p>A variety specifications of the association \(\eta_{\alpha i}(\eta_{\mu i}(t), t)\) are possible with an 
important distinction between associations which are nonlinear in \(\eta_{\mu}\)  for <code>nonlinear = TRUE</code> (Koehler et al. 2017b) or linear where \(\eta_{\alpha i}(\eta_{\mu i}(t), t) = \eta_{\alpha i}(t)\eta_{\mu i}(t)\) for <code>nonlinear = FALSE</code> (Koehler et al. 2017a).</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The indicator <code>nonlinear</code> for associations with are linear or nonlinear in \(\eta_{\mu}\) was named <code>interaction]</code> in earlier versions stages of the development.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Koehler M, Umlauf N, Beyerlein, A., Winkler, C. Ziegler, A.-G., Greven S (2017a). Flexible Bayesian Additive Joint
  Models with an Application to Type 1 Diabetes Research. Biometrical Journal, 59, 6, http://dx.doi.org/10.1002/bimj.201600224.</p>  
<p>Koehler M, Umlauf N, Greven S (2017b). Nonlinear association structures in flexible Bayesian additive 
  joint models. arXiv:1708.06337 [stat], http://arxiv.org/abs/1708.06337.</p>  
<p>Umlauf, N., Klein, N., and Zeileis, A. (2017). BAMLSS: Bayesian Additive Models for Location,
  Scale and Shape (and beyond). Working Paper, Faculty of Economics and Statistics, University of
  Innsbruck, http://EconPapers.repec.org/RePEc:inn:wpaper:2017-05.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='bamlss.html'>bamlss</a></code>, <code><a href='bamlss.frame.html'>bamlss.frame</a></code>.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Random'>set.seed</a></span>(<span class='fl'>123</span>)
<span class='co'>## Simulate survival data</span>
<span class='co'>## with random intercepts/slopes and a linear effect of time,</span>
<span class='co'>## constant association alpha and no effect of the derivative</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simJM.html'>simJM</a></span>(<span class='kw'>nsub</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>long_setting</span> <span class='kw'>=</span> <span class='st'>"linear"</span>,
  <span class='kw'>alpha_setting</span> <span class='kw'>=</span> <span class='st'>"constant"</span>,
  <span class='kw'>dalpha_setting</span> <span class='kw'>=</span> <span class='st'>"zero"</span>, <span class='kw'>full</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'>## Formula of the according joint model</span>
<span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(
  <span class='fu'><a href='Surv2.html'>Surv2</a></span>(<span class='no'>survtime</span>, <span class='no'>event</span>, <span class='kw'>obs</span> <span class='kw'>=</span> <span class='no'>y</span>) ~ <span class='fu'>s</span>(<span class='no'>survtime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>gamma</span> ~ <span class='fu'>s</span>(<span class='no'>x1</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>mu</span> ~ <span class='no'>obstime</span> + <span class='fu'>s</span>(<span class='no'>id</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"re"</span>) +
    <span class='fu'>s</span>(<span class='no'>id</span>, <span class='no'>obstime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"re"</span>),
  <span class='no'>sigma</span> ~ <span class='fl'>1</span>,
  <span class='no'>alpha</span> ~ <span class='fl'>1</span>,
  <span class='no'>dalpha</span> ~ -<span class='fl'>1</span>
)

<span class='co'>## Joint model estimation</span>
<span class='co'>## jm_bamlss() sets the default optimizer and sampler function.</span>
<span class='co'>## First, posterior mode estimates are computed using function</span>
<span class='co'>## jm.mode(), afterwards the sampler jm.mcmc() is started.</span>
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bamlss.html'>bamlss</a></span>(<span class='no'>f</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>d</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"jm"</span>,
           <span class='kw'>timevar</span> <span class='kw'>=</span> <span class='st'>"obstime"</span>, <span class='kw'>idvar</span> <span class='kw'>=</span> <span class='st'>"id"</span>)

<span class='co'>## Plot estimated effects.</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>b</span>)

<span class='co'>## Predict event probabilities for two individuals</span>
<span class='co'>## at 12 time units after their last longitudinal measurement.</span>
<span class='co'>## The event probability is conditional on their survival</span>
<span class='co'>## up to their last observed measurement.</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/predict'>predict</a></span>(<span class='no'>b</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"probabilities"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='kw'>dt</span> <span class='kw'>=</span> <span class='fl'>12</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>c95</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/print'>print</a></span>(<span class='no'>p</span>)

<span class='co'>## Plot of survival probabilities and</span>
<span class='co'>## corresponding longitudinal effects</span>
<span class='co'>## for individual id.</span>
<span class='fu'>jm.survplot</span>(<span class='no'>b</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='fu'>jm.survplot</span>(<span class='no'>b</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>30</span>)


<span class='co'>## Simulate survival data</span>
<span class='co'>## with functional random intercepts and a nonlinear effect </span>
<span class='co'>## of time, time-varying association alpha and no effect </span>
<span class='co'>## of the derivative.</span>
<span class='co'>## Note: This specification is the simJM default.</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simJM.html'>simJM</a></span>(<span class='kw'>nsub</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>full</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'>## Formula of the according joint model</span>
<span class='co'>## number of knots for the smooth nonlinear effect of time</span>
<span class='no'>klong</span> <span class='kw'>&lt;-</span> <span class='fl'>8</span>
<span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(
  <span class='fu'><a href='Surv2.html'>Surv2</a></span>(<span class='no'>survtime</span>, <span class='no'>event</span>, <span class='kw'>obs</span> <span class='kw'>=</span> <span class='no'>y</span>) ~ <span class='fu'>s</span>(<span class='no'>survtime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>gamma</span> ~ <span class='fu'>s</span>(<span class='no'>x1</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>mu</span> ~ <span class='fu'>ti</span>(<span class='no'>id</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"re"</span>) +
    <span class='fu'>ti</span>(<span class='no'>obstime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>, <span class='kw'>k</span> <span class='kw'>=</span> <span class='no'>klong</span>) +
    <span class='fu'>ti</span>(<span class='no'>id</span>, <span class='no'>obstime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"re"</span>, <span class='st'>"ps"</span>),
      <span class='kw'>k</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nlevels'>nlevels</a></span>(<span class='no'>d</span>$<span class='no'>id</span>), <span class='no'>klong</span>)) +
    <span class='fu'>s</span>(<span class='no'>x2</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>sigma</span> ~ <span class='fl'>1</span>,
  <span class='no'>alpha</span> ~ <span class='fu'>s</span>(<span class='no'>survtime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>dalpha</span> ~ -<span class='fl'>1</span>
)

<span class='co'>## Estimating posterior mode only using jm.mode()</span>
<span class='no'>b_mode</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bamlss.html'>bamlss</a></span>(<span class='no'>f</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>d</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"jm"</span>,
                 <span class='kw'>timevar</span> <span class='kw'>=</span> <span class='st'>"obstime"</span>, <span class='kw'>idvar</span> <span class='kw'>=</span> <span class='st'>"id"</span>,
                 <span class='kw'>sampler</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'>## Estimating posterior means using jm.mcmc() </span>
<span class='co'>##  with starting values generated from posterior mode </span>
<span class='no'>b_mean</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bamlss.html'>bamlss</a></span>(<span class='no'>f</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>d</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"jm"</span>,
                 <span class='kw'>timevar</span> <span class='kw'>=</span> <span class='st'>"obstime"</span>, <span class='kw'>idvar</span> <span class='kw'>=</span> <span class='st'>"id"</span>, <span class='kw'>optimizer</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
                 <span class='kw'>start</span> <span class='kw'>=</span> <span class='fu'><a href='parameters.html'>parameters</a></span>(<span class='no'>b_mode</span>), <span class='kw'>results</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'>## Plot effects.</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>b_mean</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='st'>"alpha"</span>)



<span class='co'>## Simulate survival data</span>
<span class='co'>## with functional random intercepts and an association nonlinear in mu</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Random'>set.seed</a></span>(<span class='fl'>234</span>)
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simJM.html'>simJM</a></span>(<span class='kw'>nsub</span> <span class='kw'>=</span> <span class='fl'>300</span>, <span class='kw'>long_setting</span> <span class='kw'>=</span> <span class='st'>"functional"</span>, <span class='kw'>alpha_setting</span> <span class='kw'>=</span> <span class='st'>"nonlinear"</span>,
           <span class='kw'>nonlinear</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>full</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>probmiss</span> <span class='kw'>=</span> <span class='fl'>0.9</span>)

<span class='co'>## Calculate longitudinal model to obtain starting values for mu</span>
<span class='no'>long_df</span> <span class='kw'>&lt;-</span> <span class='fl'>7</span>
<span class='no'>f_start</span> <span class='kw'>&lt;-</span> <span class='no'>y</span> ~ <span class='fu'>ti</span>(<span class='no'>id</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"re"</span>) + <span class='fu'>ti</span>(<span class='no'>obstime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>, <span class='kw'>k</span> <span class='kw'>=</span> <span class='no'>long_df</span>) +
               <span class='fu'>ti</span>(<span class='no'>id</span>, <span class='no'>obstime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"re"</span>, <span class='st'>"ps"</span>), <span class='kw'>k</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nlevels'>nlevels</a></span>(<span class='no'>d</span>$<span class='no'>id</span>), <span class='no'>long_df</span>)) +
               <span class='fu'>s</span>(<span class='no'>x2</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>)
<span class='no'>b_start</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bamlss.html'>bamlss</a></span>(<span class='no'>f_start</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>d</span>, <span class='kw'>sampler</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>mu</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/predict'>predict</a></span>(<span class='no'>b_start</span>)$<span class='no'>mu</span>

<span class='co'>## Fit joint model with nonlinear association (nonlinear = TRUE)</span>
<span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(
  <span class='fu'><a href='Surv2.html'>Surv2</a></span>(<span class='no'>survtime</span>, <span class='no'>event</span>, <span class='kw'>obs</span> <span class='kw'>=</span> <span class='no'>y</span>) ~ <span class='fu'>s</span>(<span class='no'>survtime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>gamma</span> ~ <span class='no'>x1</span>,
  <span class='no'>mu</span> ~ <span class='fu'>ti</span>(<span class='no'>id</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"re"</span>) + <span class='fu'>ti</span>(<span class='no'>obstime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>, <span class='kw'>k</span> <span class='kw'>=</span> <span class='no'>long_df</span>) +
       <span class='fu'>ti</span>(<span class='no'>id</span>, <span class='no'>obstime</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"re"</span>, <span class='st'>"ps"</span>), <span class='kw'>k</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nlevels'>nlevels</a></span>(<span class='no'>d</span>$<span class='no'>id</span>), <span class='no'>long_df</span>)) +
       <span class='fu'>s</span>(<span class='no'>x2</span>, <span class='kw'>bs</span> <span class='kw'>=</span> <span class='st'>"ps"</span>),
  <span class='no'>sigma</span> ~ <span class='fl'>1</span>,
  <span class='no'>alpha</span> ~ <span class='fl'>1</span>,
  <span class='no'>dalpha</span> ~ -<span class='fl'>1</span>
)
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bamlss.html'>bamlss</a></span>(<span class='no'>f</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>d</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"jm"</span>, <span class='kw'>timevar</span> <span class='kw'>=</span> <span class='st'>"obstime"</span>, <span class='kw'>idvar</span> <span class='kw'>=</span> <span class='st'>"id"</span>,
            <span class='kw'>nonlinear</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>start_mu</span> <span class='kw'>=</span> <span class='no'>mu</span>,
            <span class='kw'>n.iter</span> <span class='kw'>=</span> <span class='fl'>6000</span>, <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>2000</span>, <span class='kw'>thin</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>b</span>)
<span class='fu'><a href='samplestats.html'>samplestats</a></span>(<span class='no'>b</span>$<span class='no'>samples</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

