<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bivariate Gaussian models for wind vectors • bamlss</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bivariate Gaussian models for wind vectors">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bivnorm.html">Bivariate Gaussian models for wind vectors</a>
    </li>
    <li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/families.html">BAMLSS Families</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Model</a>
    </li>
    <li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Bivariate Gaussian models for wind vectors</h1>
            
      
      
      <div class="hidden name"><code>bivnorm.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>The article <strong>Bivariate Gaussian models for wind vectors in a distributional regression framework</strong> <span class="citation">(M. N. Lang et al. 2019)</span> presents a new probabilistic post-processing method for wind vectors employing the bivariate Gaussian distribution <span class="citation">(Klein et al. 2014)</span>. In contrast to previous studies all parameters of the bivariate Gaussian distribution can be modeled simultaneously, namely the location and scale parameters for both wind components and also the correlation parameter between them employing flexible regression splines. The performance of the new method is tested in <span class="citation">M. N. Lang et al. (2019)</span> for stations located in plains, mountain foreland, and within an alpine valley employing European Centre for Medium-Range Weather Forecasts (ECMWF) ensemble forecasts as explanatory variables for all distribution parameters.</p>
<p>This vignette provides example code how to set up the models employing the package BAMLSS as presented in the article.</p>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>The example code for the bivariate Gaussian models introduced in <span class="citation">M. N. Lang et al. (2019)</span> is illustrated based on the freely available EPS reforecasts of the NOAA’s second-generation global ensemble reforecast dataset <span class="citation">(Hamill et al. 2013)</span> for the 12 hour forecast step bilinearly interpolated to the site of interest. As observational data wind measurement at the <a href="http://acinn.uibk.ac.at/current-weather">Department of Atmospheric and Cryospheric Sciences</a> of the University of Innsbruck are used in this analysis (<a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>). In addition, wind measurements for Hamburg given by the Deutscher Wetterdienst (<a href="https://www.dwd.de">DWD</a>) and the corresponding ensemble forecasts are also provided but not analyzed in this vignette. At both sites, wind speed and direction measurements are reported for the 10m height level. The data are 10-minute averages and contain the period from January 1, 2015 to December 31, 2018.</p>
<p>The data for Innsbruck and Hamburg is provided <a href="http://bayesr.r-forge.r-project.org/misc/bivnorm_data.rds">here</a> and can be loaded into R with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"zoo"</span>)
dat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(<span class="st">"bivnorm_data.rds"</span>)
dat &lt;-<span class="st"> </span>dat[[<span class="st">"Innsbruck"</span>]]</code></pre></div>
</div>
<div id="baseline-model-without-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#baseline-model-without-correlation" class="anchor"></a>Baseline model without correlation</h2>
<p>In a first step, we combine two univariate heteroscedastic regression models that post-process each wind component separately with correlation fixed at zero. Hence, for the location and scale part, it uses its direct counterparts of the EPS as covariates, namely EPS-forecasted zonal wind information (<span class="math inline">\(\text{vec}_1\)</span>) to model the zonal component of the bivariate response, and EPS-forecasted meridional wind information (<span class="math inline">\(\text{vec}_2\)</span>) to model the meridional component:</p>
<span class="math display">\[\begin{align}
  \begin{split}
    \mu_{\star} &amp;=
      \underbrace{{\alpha_\star}_{0} + {f_\star}_{0}(\text{doy})}_\text{intercept} +
      \underbrace{({\alpha_\star}_{1} + {f_\star}_{1}(\text{doy}))}_\text{slope coefficient}
      \cdot \text{vec}_{\star, mean},\\[1ex]
    \text{log}(\sigma_{\star}) &amp;=
      \underbrace{{\beta_\star}_{0} + {g_\star}_{0}(\text{doy})}_\text{intercept} +
      \underbrace{({\beta_\star}_{1} + {g_\star}_{1}(\text{doy}))}_\text{slope coefficient}
      \cdot \text{vec}_{\star, log.sd},\label{eq:gam:locsc:v1}
  \end{split}
\end{align}\]</span>
<p>where, <span class="math inline">\(\alpha_\bullet\)</span> and <span class="math inline">\(\beta_\bullet\)</span> are regression coefficients, and <span class="math inline">\(f_\bullet(\text{doy})\)</span> and <span class="math inline">\(g_\bullet(\text{doy})\)</span> employ cyclic regression splines conditional on the day of the year (doy). The subscripts <span class="math inline">\(mean\)</span> and <span class="math inline">\(log.sd\)</span> refer to mean and log standard deviation of the ensemble wind components, respectively. The equation specifies a time-adaptive training scheme, where the linear predictors consist of a global intercept and slope coefficient plus a seasonally varying deviation. Thus, the intercept and slope coefficients can smoothly evolve over the year in case that the bias or the covariate’s skill varies seasonally.</p>
<p>The formulas, model fitting, and prediction are performed according to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Formulas
f_blm.u<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(u10m_obs ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>, <span class="dt">by =</span> u10m_mean),
                  sigma    ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>, <span class="dt">by =</span> u10m_sd.log))

f_blm.v<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(v10m_obs ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>, <span class="dt">by =</span> v10m_mean),
                  sigma    ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>, <span class="dt">by =</span> v10m_sd.log ))

## Model fitting
m_blm.u<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f_blm.u<span class="fl">.0</span>, <span class="dt">family =</span> bamlss:::gaussian_bamlss, <span class="dt">data =</span> dat, <span class="dt">optimizer =</span> bfit,
               <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>, <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">sampler =</span> <span class="ot">TRUE</span>, <span class="dt">nu =</span> <span class="dv">1</span>)
               
m_blm.v<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f_blm.v<span class="fl">.0</span>, <span class="dt">family =</span> bamlss:::gaussian_bamlss, <span class="dt">data =</span> dat, <span class="dt">optimizer =</span> bfit,
               <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>, <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">sampler =</span> <span class="ot">TRUE</span>, <span class="dt">nu =</span> <span class="dv">1</span>)

## Prediction
p_blm<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"mu1"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(m_blm.u<span class="fl">.0</span>, <span class="dt">type =</span> <span class="st">"parameter"</span>)$mu,
                <span class="st">"mu2"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(m_blm.v<span class="fl">.0</span>, <span class="dt">type =</span> <span class="st">"parameter"</span>)$mu,
                <span class="st">"sigma1"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(m_blm.u<span class="fl">.0</span>, <span class="dt">type =</span> <span class="st">"parameter"</span>)$sigma,
                <span class="st">"sigma2"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(m_blm.v<span class="fl">.0</span>, <span class="dt">type =</span> <span class="st">"parameter"</span>)$sigma,
                <span class="st">"rho"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(m_blm.v<span class="fl">.0</span>, <span class="dt">type =</span> <span class="st">"parameter"</span>), length))))</code></pre></div>
<p>The estimated cyclic seasonal effects are visualized for the first wind component (<span class="math inline">\(\text{vec}_1\)</span>) with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(m_blm.u<span class="fl">.0</span>, <span class="dt">pages =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="bivnorm_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
<p>For the second wind component (<span class="math inline">\(\text{vec}_2\)</span>) the effects are illustrated accordingly:</p>
<p><img src="bivnorm_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The estimated effects are on the scale of the additive predictor; i.e., on the linear scale for the location parameters <span class="math inline">\(\mu_\star\)</span> and on the log-scale for the scale parameters <span class="math inline">\(\sigma_\star\)</span>. Each of the four distribution parameters is described by a (potentially) seasonally varying effect for the intercept and the slope coefficient.</p>
</div>
<div id="rotation-allowing-model-without-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#rotation-allowing-model-without-correlation" class="anchor"></a>Rotation-allowing model without correlation</h2>
<p>In a second step, we extend the setup by employing the zonal and meridional wind information of the ensemble for the linear predictors of all location and scale parameters. That means we use the ensemble information of both the zonal and meridional wind components for the two components of the response. We propose to employ seasonally varying effects depending on the ensemble wind direction, which allows the model to rotate the forecasted wind direction if necessary. To do so, we obtain a two-dimensional smooth function represented by a tensor product spline with a respective cyclic constraint for the day of the year (doy) and for the mean ensemble wind direction (<span class="math inline">\(\text{dir}_{mean}\)</span>):</p>
<span class="math display">\[\begin{equation}
  \begin{split} 
    \mu_{\star} = {\alpha_\star}_{0} + {f_\star}_{0}(\text{doy}) &amp;+  
      ({\alpha_\star}_{1} + {f_\star}_{1}(\text{doy}) \cdot {f_\star}_{2}(\text{dir}_{mean})) \cdot \text{vec}_{1, mean}\\
      &amp;+ ({\alpha_\star}_{2} + {f_\star}_{3}(\text{doy}) \cdot {f_\star}_{4}(\text{dir}_{mean})) \cdot \text{vec}_{2, mean},\\[1ex]
    \text{log}(\sigma_{\star}) = {\beta_\star}_{0} + {g_\star}_{0}(\text{doy}) &amp;+  
      ({\beta_\star}_{1} + {g_\star}_{1}(\text{doy}) \cdot {g_\star}_{2}(\text{dir}_{mean})) \cdot \text{vec}_{1, log.sd}\\
      &amp;+ ({\beta_\star}_{2} + {g_\star}_{3}(\text{doy}) \cdot {g_\star}_{4}(\text{dir}_{mean})) \cdot \text{vec}_{2, log.sd},
    \label{eq:gam:locsc:v2}
  \end{split}
\end{equation}\]</span>
<p>where, as before, <span class="math inline">\(\alpha_\bullet\)</span> and <span class="math inline">\(\beta_\bullet\)</span> are regression coefficients, and <span class="math inline">\(f_\bullet\)</span> and <span class="math inline">\(g_\bullet\)</span> employ cyclic regression splines.</p>
<p>The model formulas are specified by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Formulas
f_ram.u<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(u10m_obs ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_mean) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_mean),
                  sigma    ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_sd.log) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_sd.log))

f_ram.v<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(v10m_obs ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_mean) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_mean),
                  sigma    ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_sd.log) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_sd.log))</code></pre></div>
</div>
<div id="rotation-allowing-models-with-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#rotation-allowing-models-with-correlation" class="anchor"></a>Rotation-allowing models with correlation</h2>
<p>We further extend the setup by explicitly modeling the correlation parameter in a bivariate Gaussian setup. For the estimation of the correlation structure, we assume that the correlation mainly depends on the mean ensemble wind direction (<span class="math inline">\(\text{dir}_{mean}\)</span>) and speed (<span class="math inline">\(\text{spd}_{mean}\)</span>) by modeling a linear interaction between these two covariates:</p>
<span class="math display">\[\begin{align}
\text{rhogit}(\rho) &amp;= \gamma_0 + h_0(\text{doy}) +
  h_1(\text{dir}_{mean}) +
  (\gamma_1 + h_2(\text{dir}_{mean})) \cdot \text{spd}_{mean}\label{eq:gam:rho},
\end{align}\]</span>
<p>with <span class="math inline">\(\text{rhogit}(\rho) = \rho / \sqrt{(1 - \rho^2)}\)</span>; <span class="math inline">\(\gamma_0\)</span> is the global intercept and <span class="math inline">\(h_0(\text{doy})\)</span> the seasonally varying intercept. The effect <span class="math inline">\(h_1(\text{dir}_{mean})\)</span> estimates the dependence of the correlation given the wind direction and <span class="math inline">\((\gamma_1 + h_2(\text{dir}_{mean})) \cdot \text{spd}_{mean}\)</span> employs a varying effect of wind speed conditional on the wind direction.</p>
<p>The formulas, model fitting, and prediction are performed according to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Formulas
f_ram.adv &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(u10m_obs ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_mean) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_mean), 
                  v10m_obs ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_mean) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_mean), 
                  sigma1   ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_sd.log) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_sd.log), 
                  sigma2   ~<span class="st"> </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> v10m_sd.log) +
<span class="st">                               </span><span class="kw">te</span>(yday, dd10m_mean, <span class="dt">k =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">bs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'cc'</span>,<span class="st">'cc'</span>), <span class="dt">by =</span> u10m_sd.log),
                  rho      ~<span class="st">   </span><span class="kw">s</span>(yday, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">s</span>(dd10m_mean, <span class="dt">bs =</span> <span class="st">'cc'</span>) +<span class="st"> </span><span class="kw">s</span>(dd10m_mean, <span class="dt">bs =</span> <span class="st">'cc'</span>, <span class="dt">by =</span> ff10m_mean))

## Model fitting
m_ram.adv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f_ram.adv, <span class="dt">family =</span> bamlss:::bivnorm_bamlss, <span class="dt">data =</span> dat, <span class="dt">optimizer =</span> bfit,
               <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>, <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">sampler =</span> <span class="ot">TRUE</span>, <span class="dt">nu =</span> <span class="dv">1</span>)

## Prediction
p_ram.adv &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(m_ram.adv, <span class="dt">type =</span> <span class="st">"parameter"</span>)</code></pre></div>
<p>The distribution of the correlation parameters for the underlying dependence structure of the raw ensemble and for the fitted bivariate model is visualized with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(dat$uv10m_cor, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(-<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/gray">gray</a></span>(<span class="fl">0.8</span>), <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">breaks =</span> <span class="dv">17</span>, 
  <span class="dt">xlab =</span> <span class="st">"Correlation parameter"</span>, <span class="dt">main =</span> <span class="st">"Raw ensemble"</span>, <span class="dt">cex.main =</span> <span class="fl">0.8</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(p_ram.adv$rho, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(-<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/gray">gray</a></span>(<span class="fl">0.8</span>), <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">breaks =</span> <span class="dv">17</span>, 
  <span class="dt">xlab =</span> <span class="st">"Correlation parameter"</span>, <span class="dt">main =</span> <span class="st">"Fitted bivariate model"</span>, <span class="dt">cex.main =</span> <span class="fl">0.8</span>)</code></pre></div>
<p><img src="bivnorm_files/figure-html/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-bamlss:hamill+etal:2013">
<p>Hamill, Thomas M., Gary T. Bates, Jeffrey S. Whitaker, Donald R. Murray, Michael Fiorino, Thomas J. Galarneau, Yuejian Zhu, and William Lapenta. 2013. “NOAA’s Second-Generation Global Medium-Range Ensemble Reforecast Dataset.” <em>Bulletin of the American Meteorological Society</em> 94 (10): 1553–65. doi:<a href="https://doi.org/10.1175/BAMS-D-12-00014.1">10.1175/BAMS-D-12-00014.1</a>.</p>
</div>
<div id="ref-bamlss:Klein+Kneib+Klasen+Lang:2014">
<p>Klein, Nadja, Thomas Kneib, Stephan Klasen, and Stefan Lang. 2014. “Bayesian Structured Additive Distributional Regression for Multivariate Responses.” <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em> 64 (4): 569–91. doi:<a href="https://doi.org/10.1111/rssc.12090">10.1111/rssc.12090</a>.</p>
</div>
<div id="ref-bamlss:Lang+Mayr+Stauffer+Zeileis:2019">
<p>Lang, Moritz N., Georg J. Mayr, Reto Stauffer, and Achim Zeileis. 2019. “Bivariate Gaussian Models for Wind Vectors in a Distributional Regression Framework.” ArXiv 1904.01659. arXiv.org E-Print Archive. <a href="http://arxiv.org/abs/1904.01659" class="uri">http://arxiv.org/abs/1904.01659</a>.</p>
</div>
<div id="ref-bamlss:Umlauf+bamlss:2018">
<p>Umlauf, Nikolaus, Nadja Klein, Achim Zeileis, and Thorsten Simon. 2018. <em><strong>Bamlss</strong>: Bayesian Additive Models for Location Scale and Shape (and Beyond)</em>. <a href="http://CRAN.R-project.org/package=bamlss" class="uri">http://CRAN.R-project.org/package=bamlss</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#intro">Intro</a></li>
      <li><a href="#data">Data</a></li>
      <li><a href="#baseline-model-without-correlation">Baseline model without correlation</a></li>
      <li><a href="#rotation-allowing-model-without-correlation">Rotation-allowing model without correlation</a></li>
      <li><a href="#rotation-allowing-models-with-correlation">Rotation-allowing models with correlation</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
