<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualization with distreg.vis • bamlss</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualization with distreg.vis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/families.html">Families</a>
    </li>
    <li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Example</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Publications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bivnorm.html">Bivariate Gaussian Models for Wind Vectors</a>
    </li>
    <li>
      <a href="../articles/lasso.html">LASSO-Type Penalization in the Framework of GAMLSS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Visualization with distreg.vis</h1>
            
      
      
      <div class="hidden name"><code>distregvis.Rmd</code></div>

    </div>

    
    
<div id="r-package-distreg-vis" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package-distreg-vis" class="anchor"></a>R package distreg.vis</h2>
<p>The <a href="https://github.com/Stan125/distreg.vis"><em>distreg.vis</em></a> <span class="citation">(Stadlmann 2019)</span> package for R allows us to interactively explore the predicted response distribution using different covariate scenarios.</p>
</div>
<div id="example-islrwage-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#example-islrwage-dataset" class="anchor"></a>Example: ISLR::Wage dataset</h2>
<p>As a short introduction to distributional regression, we are going to take a look at a dataset on the wage of 3000 male workers in the Mid-Atlantic Region of the US. The dataset is contained in the <a href="https://cran.r-project.org/package=ISLR"><em>ISLR</em></a> <span class="citation">(James et al. 2017)</span> package for R. We may output the first 6 rows of the dataset with the following R command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ISLR::Wage)</code></pre></div>
<pre><code>##        year age           maritl     race       education             region
## 231655 2006  18 1. Never Married 1. White    1. &lt; HS Grad 2. Middle Atlantic
## 86582  2004  24 1. Never Married 1. White 4. College Grad 2. Middle Atlantic
## 161300 2003  45       2. Married 1. White 3. Some College 2. Middle Atlantic
## 155159 2003  43       2. Married 3. Asian 4. College Grad 2. Middle Atlantic
## 11443  2005  50      4. Divorced 1. White      2. HS Grad 2. Middle Atlantic
## 376662 2008  54       2. Married 1. White 4. College Grad 2. Middle Atlantic
##              jobclass         health health_ins  logwage      wage
## 231655  1. Industrial      1. &lt;=Good      2. No 4.318063  75.04315
## 86582  2. Information 2. &gt;=Very Good      2. No 4.255273  70.47602
## 161300  1. Industrial      1. &lt;=Good     1. Yes 4.875061 130.98218
## 155159 2. Information 2. &gt;=Very Good     1. Yes 5.041393 154.68529
## 11443  2. Information      1. &lt;=Good     1. Yes 4.318063  75.04315
## 376662 2. Information 2. &gt;=Very Good     1. Yes 4.845098 127.11574</code></pre>
<p>The variable names and factor labels are mostly self-explanatory, but we can look up the details by running <code><a href="https://www.rdocumentation.org/packages/ISLR/topics/Wage">?ISLR::Wage</a></code>. Our goal is to link wage to a number of relevant explanatory variables. One main driver of wage should be education, so let us start by descriptively investigating the relationship between these two variables. This R code plots the distribution of wage across the different education levels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"ggplot2"</span>)

<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(ISLR::Wage, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> wage, <span class="dt">y =</span> ..density.., <span class="dt">fill =</span> education)) +
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="dt">alpha =</span> <span class="fl">0.8</span>) +
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span>() +
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Wages by education level"</span>)</code></pre></div>
<p><img src="distregvis_files/figure-html/unnamed-chunk-2-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The graph shows that education does have a big influence on wage. A higher education level shifts the wage distribution to the right, but it also increases the variance and changes the shape of the distribution. One striking feature of the empirical wage distribution is its bump between 250 and 300. There is no explanation for this bump in the dataset or its help page, so we have to assume it is a anomaly of the sample.</p>
</div>
<div id="setting-up-an-appropriate-model" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-an-appropriate-model" class="anchor"></a>Setting up an appropriate model</h2>
<p>When modeling wage, we need to take into account its special characteristics as a random variable: It is positive (or non-negative, but our dataset does not contain any zeros) and its distribution is right-skewed. These characteristics make distributional regression an appropriate tool for the task at hand.</p>
<p>Based on the characteristics of wage, we choose the <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">log-normal distribution</a> for our model. The log-normal distribution has positive support, it is right-skewed, and it has a location parameter <span class="math inline">\(\mu\)</span> and a scale parameter <span class="math inline">\(\sigma\)</span>. The idea of distributional regression is to link all parameters of the response distribution to explanatory variables. In our case, these will be education, age, race, and year.</p>
<p>The following R code specifies and estimates our model using the <code>LOGNO</code> family of the <em>gamlss</em> package <span class="citation">(Stasinopoulos and Rigby 2018)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"bamlss"</span>)

## Get the gamlss families.
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"gamlss"</span>)

## Model formula.
f &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
  wage ~<span class="st"> </span><span class="kw">s</span>(age) +<span class="st"> </span>race +<span class="st"> </span>year +<span class="st"> </span>education,
  sigma ~<span class="st"> </span><span class="kw">s</span>(age) +<span class="st"> </span>race +<span class="st"> </span>year +<span class="st"> </span>education
)

## Estimates model using full MCMC.
b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f, <span class="dt">data =</span> ISLR::Wage, <span class="dt">family =</span> LOGNO)</code></pre></div>
<p>We may take a look at the estimation results with this R command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(b)</code></pre></div>
<pre><code>## 
## Call:
## bamlss(formula = f, family = LOGNO, data = ISLR::Wage)
## ---
## Family: LOGNO 
## Link function: mu = identity, sigma = log
## *---
## Formula mu:
## ---
## wage ~ s(age) + race + year + education
## -
## Parametric coefficients:
##                                   Mean       2.5%        50%      97.5% parameters
## (Intercept)                 -19.909954 -30.108357 -19.866270 -10.381230    -20.137
## race2. Black                 -0.051765  -0.087148  -0.051823  -0.018516     -0.051
## race3. Asian                 -0.047859  -0.091039  -0.047183  -0.006092     -0.048
## race4. Other                 -0.066772  -0.162274  -0.066709   0.027615     -0.068
## year                          0.012130   0.007358   0.012109   0.017216      0.012
## education2. HS Grad           0.117845   0.080860   0.117468   0.155866      0.118
## education3. Some College      0.237682   0.200591   0.237531   0.276783      0.237
## education4. College Grad      0.351398   0.312607   0.351472   0.391559      0.351
## education5. Advanced Degree   0.517436   0.471827   0.517490   0.560642      0.517
## alpha                         0.999945   0.999710   1.000000   1.000000         NA
## -
## Smooth terms:
##                 Mean    2.5%     50%   97.5% parameters
## s(age).tau21 0.33509 0.05927 0.22951 1.20845      0.328
## s(age).alpha 1.00000 1.00000 1.00000 1.00000         NA
## s(age).edf   6.01066 4.53129 5.96266 7.62728      6.378
## ---
## Formula sigma:
## ---
## sigma ~ s(age) + race + year + education
## -
## Parametric coefficients:
##                                  Mean      2.5%       50%     97.5% parameters
## (Intercept)                 37.270967 14.630197 37.326260 60.188649     37.993
## race2. Black                 0.005193 -0.081343  0.006233  0.090754      0.005
## race3. Asian                -0.013599 -0.118036 -0.012866  0.088751     -0.015
## race4. Other                 0.064204 -0.180577  0.059655  0.308023      0.040
## year                        -0.019260 -0.030680 -0.019300 -0.007956     -0.020
## education2. HS Grad          0.071944 -0.028430  0.072394  0.165987      0.071
## education3. Some College     0.049722 -0.057854  0.049705  0.145863      0.048
## education4. College Grad     0.198478  0.098632  0.199329  0.304347      0.199
## education5. Advanced Degree  0.260990  0.150081  0.261134  0.367533      0.262
## alpha                        0.907093  0.568144  0.972426  1.000000         NA
## -
## Smooth terms:
##                Mean   2.5%    50%  97.5% parameters
## s(age).tau21 2.6202 0.4712 2.0438 7.8435      1.954
## s(age).alpha 0.9132 0.5182 0.9734 1.0000         NA
## s(age).edf   6.2290 4.6743 6.2680 7.5835      6.213
## ---
## Sampler summary:
## -
## DIC = 29013.04 logLik = -14491.5 pd = 30.0486
## runtime = 22.79
## ---
## Optimizer summary:
## -
## AICc = 29013.48 converged = 1 edf = 30.5912
## logLik = -14475.82 logPost = -14637.55 nobs = 3000
## runtime = 0.654
## ---</code></pre>
<p>The output is similar to the summary of a linear model. For each parameter of the response distribution, we get a regression table with slope coefficients, etc. Unfortunately, the coefficients are hard to interpret because they are related to different aspects of the response distribution. Moreover, the scale parameter <span class="math inline">\(\sigma\)</span> is transformed with a log-link.</p>
</div>
<div id="explore-the-model-with-distreg-vis" class="section level2">
<h2 class="hasAnchor">
<a href="#explore-the-model-with-distreg-vis" class="anchor"></a>Explore the model with <em>distreg.vis</em>
</h2>
<p>One way to understand the meaning of the coefficients is to define different “covariate scenarios” and take a look at the corresponding predicted response distributions. The <a href="https://github.com/Stan125/distreg.vis"><em>distreg.vis</em></a> <span class="citation">(Stadlmann 2019)</span> package for R allows us to do so interactively:</p>
<p><a target="_blank" class="btn btn-primary" href="http://141.5.104.49:3838/distreg_app/" role="button">Explore the model with distreg.vis</a></p>
<p>The corresponding R code that starts the app locally is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distreg.vis::<span class="kw">vis</span>()</code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-bamlss:ISLR">
<p>James, Gareth, Daniela Witten, Trevor Hastie, and Rob Tibshirani. 2017. <em>ISLR: Data for an Introduction to Statistical Learning with Applications in R</em>. <a href="https://CRAN.R-project.org/package=ISLR" class="uri">https://CRAN.R-project.org/package=ISLR</a>.</p>
</div>
<div id="ref-bamlss:distreg-vis">
<p>Stadlmann, Stanislaus. 2019. <em>Distreg.vis: Framework for the Visualization of Distributional Regression Models</em>. <a href="https://CRAN.R-project.org/package=distreg.vis" class="uri">https://CRAN.R-project.org/package=distreg.vis</a>.</p>
</div>
<div id="ref-bamlss:Stasinopoulos+Rigby:2018">
<p>Stasinopoulos, Mikis, and Bob Rigby. 2018. <em>Gamlss: Generalised Additive Models for Location Scale and Shape</em>. <a href="https://CRAN.R-project.org/package=gamlss" class="uri">https://CRAN.R-project.org/package=gamlss</a>.</p>
</div>
<div id="ref-bamlss:Umlauf+bamlss:2018">
<p>Umlauf, Nikolaus, Nadja Klein, Achim Zeileis, and Thorsten Simon. 2018. <em><span class="math inline">\(\phantom{.}\)</span><strong>Bamlss</strong>: Bayesian Additive Models for Location Scale and Shape (and Beyond)</em>. <a href="http://CRAN.R-project.org/package=bamlss" class="uri">http://CRAN.R-project.org/package=bamlss</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#r-package-distreg-vis">R package distreg.vis</a></li>
      <li><a href="#example-islrwage-dataset">Example: ISLR::Wage dataset</a></li>
      <li><a href="#setting-up-an-appropriate-model">Setting up an appropriate model</a></li>
      <li><a href="#explore-the-model-with-distreg-vis">Explore the model with <em>distreg.vis</em></a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
