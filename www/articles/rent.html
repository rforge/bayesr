<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Munich Rent Model • bamlss</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Munich Rent Model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bamlss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bamlss.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/distregvis.html">Visualization with distreg.vis</a>
    </li>
    <li>
      <a href="../articles/families.html">BAMLSS Families</a>
    </li>
    <li>
      <a href="../articles/glm.html">Generalized Linear Models (+)</a>
    </li>
    <li>
      <a href="../articles/misc.html">Miscellaneous Topics</a>
    </li>
    <li>
      <a href="../articles/rent.html">Munich Rent Model</a>
    </li>
    <li>
      <a href="../articles/terms.html">Available Model Terms</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Munich Rent Model</h1>
            
      
      
      <div class="hidden name"><code>rent.Rmd</code></div>

    </div>

    
    
<p>In this example we analyze rent index data from Munich, Germany. The data is provided in the supplemental materials of the Regression book <span class="citation">(Fahrmeir et al. 2013)</span> and can be loaded into R with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">file_url &lt;-<span class="st"> "http://www.uni-goettingen.de/de/document/download/64c29c1b1fccb142cfa8f29a942a9e05.raw/rent99.raw"</span>
rent99 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(file_url, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The aim of this analysis is to find a model explaining the rent or rent per square meter of an apartment. We first assume a linear relationship with homoscedastic Gaussian errors:</p>
<p><span class="math display">\[
\texttt{rent} = \mu = \beta_0 + \beta_1 \cdot \texttt{area} + \beta_2 \cdot \texttt{yearc},
\]</span> i.e., <span class="math inline">\(\texttt{rent} \sim N(\mu, \sigma^2)\)</span>. The model can be estimated with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Model formula.
f1 &lt;-<span class="st"> </span>rent ~<span class="st"> </span>area +<span class="st"> </span>yearc

## Estimate model.
b1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f1, <span class="dt">data =</span> rent99, <span class="dt">family =</span> <span class="st">"gaussian"</span>,
  <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>)</code></pre></div>
<p>This first starts a backfitting algorithm to find posterior mode estimates and afterwards the MCMC simulation is started using the parameters from the backfitting step as starting values. Note that we use 12000 iterations with a burnin of 2000 and only keep every 10th sample of the MCMC simulation. The model summary gives</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(b1)</code></pre></div>
<pre><code>## 
## Call:
## bamlss(formula = rent ~ area + yearc, family = "gaussian", data = rent99, 
##     n.iter = 12000, burnin = 2000, thin = 10)
## ---
## Family: gaussian 
## Link function: mu = identity, sigma = log
## *---
## Formula mu:
## ---
## rent ~ area + yearc
## -
## Parametric coefficients:
##                   Mean       2.5%        50%      97.5% parameters
## (Intercept) -4.486e+03 -4.953e+03 -4.488e+03 -3.936e+03  -4775.594
## area         5.328e+00  5.098e+00  5.323e+00  5.557e+00      5.362
## yearc        2.345e+00  2.069e+00  2.346e+00  2.584e+00      2.491
## alpha        4.212e-01  1.076e-02  2.678e-01  1.000e+00         NA
## ---
## Formula sigma:
## ---
## sigma ~ 1
## -
## Parametric coefficients:
##              Mean  2.5%   50% 97.5% parameters
## (Intercept) 5.007 4.982 5.007 5.031      5.005
## alpha       0.993 0.934 1.000 1.000         NA
## ---
## Sampler summary:
## -
## DIC = 39609.71 logLik = -19802.83 pd = 4.0537
## runtime = 26.134
## ---
## Optimizer summary:
## -
## AICc = 39608.2 converged = 1 edf = 4
## logLik = -19800.1 logPost = -19842.81 nobs = 3082
## runtime = 0.016
## ---</code></pre>
<p>However, the assumption of homoscedastic errors is not appropriate in this case.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(rent ~<span class="st"> </span>area, <span class="dt">data =</span> rent99)</code></pre></div>
<p><img src="rent_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"> As can be seen in this scatter plot, the data is heteroscedastic and the exact model might not even be linear. This is also indicated in the quantile residual plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(b1, <span class="dt">which =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"hist-resid"</span>, <span class="st">"qq-resid"</span>))</code></pre></div>
<p><img src="rent_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"> The residuals seem to be a bit skew and for the lower and higher values of <code>rent</code>, the model fit is not satisfactorily according the Q-Q plot.</p>
<p>A non-parametric model can be useful here. Therefore, we estimate a more flexible model with <span class="math display">\[
\mu = \beta_0 + f_1(\texttt{area}) + f_2(\texttt{yearc})
\]</span> and <span class="math display">\[
\sigma = \exp\{\alpha_0 + g_1(\texttt{area}) + g_2(\texttt{yearc})\}
\]</span> where functions <span class="math inline">\(f_1( \cdot ), f_2( \cdot ), g_1( \cdot ), g_2( \cdot )\)</span> are modeled using regression splines. The exponential function assures that the we estimate a positive standard deviation. This way, we allow for covariates and loose the hard assumptions of a constant standard deviation.</p>
<p>The model is estimated with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## List of formulae to estimate
## heteroskedastic Gaussian model.
f2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
  rent ~<span class="st"> </span><span class="kw">s</span>(area,<span class="dt">k=</span><span class="dv">20</span>) +<span class="st"> </span><span class="kw">s</span>(yearc,<span class="dt">k=</span><span class="dv">20</span>),
  sigma ~<span class="st"> </span><span class="kw">s</span>(area,<span class="dt">k=</span><span class="dv">20</span>) +<span class="st"> </span><span class="kw">s</span>(yearc,<span class="dt">k=</span><span class="dv">20</span>)
)

b2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bamlss.html">bamlss</a></span>(f2, <span class="dt">data =</span> rent99, <span class="dt">family =</span> <span class="st">"gaussian"</span>,
  <span class="dt">n.iter =</span> <span class="dv">12000</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">thin =</span> <span class="dv">10</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(b2)</code></pre></div>
<pre><code>## 
## Call:
## bamlss(formula = f2, family = "gaussian", data = rent99, n.iter = 12000, 
##     burnin = 2000, thin = 10)
## ---
## Family: gaussian 
## Link function: mu = identity, sigma = log
## *---
## Formula mu:
## ---
## rent ~ s(area, k = 20) + s(yearc, k = 20)
## -
## Parametric coefficients:
##                 Mean     2.5%      50%    97.5% parameters
## (Intercept) 458.6800 453.2719 458.6406 463.8725      459.1
## alpha         0.9995   0.9977   1.0000   1.0000         NA
## -
## Smooth terms:
##                     Mean      2.5%       50%     97.5% parameters
## s(area).tau21  1.751e+04 5.023e-01 6.201e+03 9.066e+04   41160.87
## s(area).alpha  1.000e+00 1.000e+00 1.000e+00 1.000e+00         NA
## s(area).edf    3.569e+00 1.001e+00 3.529e+00 7.035e+00       5.83
## s(yearc).tau21 7.550e+03 4.926e+02 4.273e+03 3.708e+04   70028.12
## s(yearc).alpha 1.000e+00 1.000e+00 1.000e+00 1.000e+00         NA
## s(yearc).edf   5.853e+00 3.493e+00 5.731e+00 9.006e+00      10.39
## ---
## Formula sigma:
## ---
## sigma ~ s(area, k = 20) + s(yearc, k = 20)
## -
## Parametric coefficients:
##               Mean   2.5%    50%  97.5% parameters
## (Intercept) 4.8474 4.8210 4.8474 4.8729      4.841
## alpha       0.9925 0.9411 0.9999 1.0000         NA
## -
## Smooth terms:
##                     Mean      2.5%       50%     97.5% parameters
## s(area).tau21  0.0909891 0.0003845 0.0382569 0.5388624      0.029
## s(area).alpha  0.9539833 0.6923144 0.9939831 1.0000000         NA
## s(area).edf    2.6291780 1.0555217 2.5233938 5.0426360      2.325
## s(yearc).tau21 0.1106165 0.0148046 0.0788342 0.3899121      0.097
## s(yearc).alpha 0.9405832 0.6406995 0.9903837 1.0000000         NA
## s(yearc).edf   5.0416773 3.4075129 4.9333587 7.1488541      5.257
## ---
## Sampler summary:
## -
## DIC = 38650.06 logLik = -19313.72 pd = 22.6218
## runtime = 172.902
## ---
## Optimizer summary:
## -
## AICc = 38637.94 converged = 1 edf = 25.8059
## logLik = -19292.94 logPost = -19511.55 nobs = 3082
## runtime = 0.838
## ---</code></pre>
<p>The summary statistics indicate that the more flexible model is more appropriate since the DIC of model <code>b2</code> is much lower than the DIC of model <code>b1</code>.</p>
<p>The estimated effects are visualized with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(b2, <span class="dt">ask =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="rent_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"> By looking at the effect plots, we can conclude that in the case of the variable <code>area</code> an assumption of linear dependency might be justified, where in the case of <code>yearc</code> this is not so clear. Moreover, our estimated <code>sigma</code> is for neither of the variables constant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(b2, <span class="dt">which =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"hist-resid"</span>, <span class="st">"qq-resid"</span>))</code></pre></div>
<p><img src="rent_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"> The quantile residual plots indicate a quite good model fit already, however, the assumption of Gaussian errors could be refined as rents can only be positive. Hence, distributions accounting for this fact should be exploited further, e.g., the Gamma distribution.</p>
<div id="refs" class="references">
<div id="ref-bamlss:Fahrmeir+Kneib+Lang+Marx:2013">
<p>Fahrmeir, Ludwig, Thomas Kneib, Stefan Lang, and Brian Marx. 2013. <em>Regression – Models, Methods and Applications</em>. Berlin: Springer-Verlag.</p>
</div>
<div id="ref-bamlss:Umlauf+bamlss:2018">
<p>Umlauf, Nikolaus, Nadja Klein, Achim Zeileis, and Thorsten Simon. 2018. <em><strong>Bamlss</strong>: Bayesian Additive Models for Location Scale and Shape (and Beyond)</em>. <a href="http://CRAN.R-project.org/package=bamlss" class="uri">http://CRAN.R-project.org/package=bamlss</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nikolaus Umlauf, Nadja Klein, Achim Zeileis, Thorsten Simon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
